<% function content_for_head() %>
<title>Websocket Chat Demo</title>
<script src="js/jquery-1.4.1.min.js" type="text/javascript"></script>
<% end %>

<% function content_for_body() %>

<form onsubmit="return send()">
  <input type="text" id="msg"/>
  <input type="submit"/>
</form>

<div id="log">
</div>

<script> 
  function append(msg){
    d = new Date();
    $("#log").prepend("[" + d.getHours() + ':' + d.getMinutes() + ':' + d.getSeconds() + "] " + msg + "<br />");
  }
  function send(){
    s.send($('#msg').val()); 
    $('#msg').select(); 
    return false;
  }
  
  $('#msg').select();
  s = new WebSocket('ws://'+ location.host + '/chat');
  s.onopen = function () {append("connected")};
  s.onmessage = function (evt) {append(evt.data)};
  s.onclose = function () {append("disconnected")};
</script> 
<% end %>

